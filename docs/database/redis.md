# Redis åŸºç¡€å…¥é—¨ç¯‡

Redis æ˜¯ä¸€ä¸ªå…è´¹å¼€æºã€åŸºäºå†…å­˜çš„é«˜æ€§èƒ½ Key-Value æ•°æ®åº“ï¼Œæ®é˜…è¯»æ’è¡Œæ¦œç½‘ç«™ db-engines.com ç»Ÿè®¡ï¼Œåœ¨ Key-value å­˜å‚¨çš„æ•°æ®åº“ä¸­ Redis ä¾æ—§æ˜¯æœ€æµè¡Œçš„ã€‚

## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Redisï¼Ÿéƒ½æœ‰å“ªäº›å¥½å¤„ï¼Ÿ

æ¯‹åº¸ç½®ç–‘ Redis çš„åº”ç”¨èŒƒå›´æ˜¯å¾ˆå¹¿æ³›çš„ï¼ŒRedis å…·æœ‰é€Ÿåº¦å¿«ã€æ•°æ®æŒä¹…åŒ–ã€ä¸°å¯Œçš„æ•°æ®ç±»å‹ã€å¤šè¯­è¨€æ”¯æŒå’Œå¤šåŠŸèƒ½ç­‰ç‰¹æ€§ï¼Œä¸‹é¢åˆ†åˆ«äº†è§£ä¸‹æ¯ç§ç‰¹æ€§ã€‚

**é€Ÿåº¦å¿«**

Redis å·ç§°å…·æœ‰ 10W OPSï¼ˆæ¯ç§’10ä¸‡æ¬¡è¯»å†™ï¼‰çš„èƒ½åŠ›ï¼ŒRedis æ˜¯åŸºäºå•çº¿ç¨‹æ¨¡å‹ï¼Œå°†æ•°æ®å­˜åœ¨äºå†…å­˜ä¸­ï¼Œé‡‡ç”¨ C è¯­è¨€(è·æ“ä½œç³»ç»Ÿæœ€è¿‘çš„è¯­è¨€) 50000 è¡Œä»£ç ï¼ˆå•æœºç‰ˆçš„ 23000 è¡Œï¼‰ç¼–å†™ã€‚

ä¸ºä»€ä¹ˆå•çº¿ç¨‹æ¨¡å‹å¦‚æ­¤ä¹‹å¿«ï¼Ÿå–å†³äºå‡ ä¸ªä¼˜ç‚¹ï¼šåŸºäºå†…å­˜ã€éé˜»å¡IOã€é¿å…çº¿ç¨‹åˆ‡æ¢ï¼Œè¿™ç‚¹å’Œ Node.js å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯å•çº¿ç¨‹éœ€è¦æ³¨æ„ç”±äºä¸€æ¬¡åªèƒ½è¿è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­è¦æ‹’ç»æ…¢å‘½ä»¤ï¼Œä¾‹å¦‚ keysã€flushallã€flushdbã€slow lua scriptã€mutil/exec ç­‰

**æŒä¹…åŒ–**

Redis ä¹‹æ‰€ä»¥å¿«è¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯å…¶åŸºäºå†…å­˜æ¨¡å‹ï¼Œå†…å­˜ä¸­è¿›è¡Œæ•°æ®å­˜å‚¨ä¸€ä¸ªå…¸å‹çš„é—®é¢˜æ˜¯æ–­ç”µåæˆ–è€…æœåŠ¡é‡å¯ä¼šé€ æˆæ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆé’ˆå¯¹è¿™ä¸ªé—®é¢˜ Redis ä¸­æå‡ºäº†ä¸¤ç§æ•°æ®æŒä¹…åŒ–ç­–ç•¥ï¼Œåˆ†åˆ«ä¸º RDB å’Œ AOF ä¼šå°† Redis åœ¨å†…å­˜ä¸­ä¿å­˜çš„æ•°æ®å¼‚æ­¥æ›´æ–°åˆ°ç£ç›˜ä¸­ï¼Œå®ç°æ•°æ®çš„æŒä¹…åŒ–åŠŸèƒ½ï¼Œè¿™åœ¨ä¹‹åçš„ä¸€èŠ‚ä¸­ä¼šå•ç‹¬è¿›è¡Œä»‹ç»ã€‚

**ä¸°å¯Œçš„æ•°æ®ç±»å‹**

Redis æ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œé™¤äº†äº”ä¸ªå¸¸è§çš„çš„ Stringã€HashTableã€Listã€Setã€Zset ä¹‹å¤– Redis è¿˜æ–°è¡ç”Ÿäº†å‡ ä¸ªæ–°çš„ç±»å‹ï¼š`BitMaps`ï¼ˆä½å›¾ï¼‰ã€`HyperLogLog`ï¼ˆè¶…å°å†…å­˜å”¯ä¸€è®¡æ•°ï¼‰ã€`GEO`ï¼ˆåœ°ç†ä¿¡æ¯å®šä½ï¼‰

**å¤šè¯­è¨€**

åŸºäº `TCP` çš„é€šä¿¡æ–¹å¼ï¼Œæ”¯æŒ `Node.js`ã€`Python`ã€`Java`ã€`Ruby`ã€`Lua` ç­‰ï¼Œå¯ä»¥å‚è€ƒ Redis å®˜æ–¹ä»‹ç» [https://redis.io/clients](https://redis.io/clients) ï¼Œæ¯é—¨è¯­è¨€å¯èƒ½ä¼šæœ‰å¥½å¤šä¸ªå®¢æˆ·ç«¯ï¼Œè¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿå¯ä»¥å‚è€ƒä»¥ä¸‹ä¸¤ç‚¹ï¼š

* é¦–å…ˆå¯ä»¥é€‰æ‹©æ ‡è®°æœ‰äº”è§’æ˜Ÿ â­ï¸ çš„å®¢æˆ·ç«¯
* æœ‰ç¬‘è„¸ ğŸ˜Š æ ‡è®°çš„è¯´æ˜è¯¥å®¢æˆ·ç«¯æœ€è¿‘ 6 ä¸ªæœˆæ˜¯æ´»è·ƒçš„

![Nodejs Redis å®¢æˆ·ç«¯](./img/redis-client-language-nodejs.png)

**å¤šåŠŸèƒ½**

Redis æä¾›äº†å‘å¸ƒè®¢é˜…ã€ç®€å•çš„äº‹åŠ¡åŠŸèƒ½ã€pipeline æé«˜å®¢æˆ·ç«¯å¹¶å‘æ•ˆç‡ã€‚å¦å¤–åœ¨ Redis ä¸­çš„æ‰€æœ‰å•ä¸ªå‘½ä»¤æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œå¦‚æœæƒ³å¯¹å¤šä¸ªå‘½ä»¤ä¸€èµ·æ“ä½œï¼Œå¯ä»¥å€ŸåŠ© Lua è„šæœ¬ï¼ˆå®ç°è‡ªå®šä¹‰å‘½ä»¤ï¼Œä¿è¯åŸå­æ€§ï¼‰ã€‚

## Redis ä¸ Memcache çš„åŒºåˆ«ï¼Ÿ

å¯ä»¥é€‰æ‹© Redis åšç¼“å­˜ä¹Ÿå¯ä»¥ä½¿ç”¨ Memcache æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥çœ‹å¾…ï¼š

**æ•°æ®æŒä¹…åŒ–**

Memcache ä»…å­˜äºå†…å­˜ä¸­ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œè¿™æ ·å¦‚æœæ–­ç”µæˆ–æœåŠ¡é‡å¯éƒ½ä¼šé€ æˆæ•°æ®ä¸¢å¤±ï¼Œè€Œ Redis æä¾›äº†æ•°æ®æŒä¹…åŒ–çš„èƒ½åŠ›ï¼Œå¯ä»¥åˆ†åˆ«é€šè¿‡ RDB æˆ– AOF ä¸¤ç§ç­–ç•¥å°†æ•°æ®æŒä¹…åŒ–åœ¨ç¡¬ç›˜ä¸­ï¼ŒæœåŠ¡é‡å¯æˆ–æ–­ç”µä¹Ÿä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€‚

**æ•°æ®ç±»å‹**

Memcache å¯¹æ•°æ®ç±»å‹çš„æ”¯æŒç›¸å¯¹è¦ç®€å•ã€è¿‡äºå•ä¸€ï¼ŒRedis çš„æ•°æ®ç±»å‹å°±æ˜¾å¾—å¾ˆä¸°å¯Œï¼Œæ”¯æŒ Stringã€HashTableã€Listã€Setã€Zset è¿˜æœ‰æœ€æ–°çš„ BitMapsã€HyperLogLog ç­‰

**Value å¤§å°**

åœ¨ Redis ä¸­ Value å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€äºŒè¿›åˆ¶æ•°æ®ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ Value å†…å­˜å‚¨ jpeg å›¾åƒï¼Œä½†æ˜¯å»ºè®®å€¼ä¸è¦å¤§äº 512 MBï¼Œè¿™å—å¯ä»¥åœ¨ Redis å®˜ç½‘çœ‹åˆ°ï¼Œä»¥ä¸‹ä¸ºåŸæ–‡ï¼š

```
Values can be strings (including binary data) of every kind, for instance you can store a jpeg image inside a value. A value can't be bigger than 512 MB.
```

Memcache çš„æœ€å¤§ key é•¿åº¦ä¸º 250 ä¸ªå­—ç¬¦ï¼Œå¯ä»¥æ¥å—çš„ Value å­˜å‚¨æ•°æ®å¤§å°ä¸º 1MBï¼Œè¿™ä¹Ÿæ˜¯å…¸å‹çš„ slab æœ€å¤§å€¼ã€‚

**ç½‘ç»œ I/O æ¨¡å‹**

Redis ä½¿ç”¨çš„å•çº¿ç¨‹ I/O å¤šè·¯å¤ç”¨æ¨¡å‹ï¼ŒMemcache ä½¿ç”¨çš„å¤šçº¿ç¨‹ã€éé˜»å¡å¼ I/O æ¨¡å‹ã€‚

**æ•°æ®ä¸€è‡´æ€§**

Redis åŸºäºå•çº¿ç¨‹æ¨¡å‹ï¼Œä¿è¯äº†é¡ºåºä¸€è‡´æ€§é—®é¢˜ï¼Œå¦‚æœæœ‰å¤šä¸ªå‘½ä»¤éœ€è¦ä¸€èµ·æ“ä½œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨äº‹ç‰©æˆ–è€…ç¼–å†™ Lua è„šæœ¬ã€‚Memcache éœ€è¦å€ŸåŠ© CASï¼ˆCompare And Setï¼‰ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œç®€å•çš„ç†è§£å°±æ˜¯åœ¨è¿›è¡Œ set æ“ä½œæ—¶ï¼ŒåŠ ä¸Šåˆå§‹å€¼ Compareï¼Œå¦‚æœåˆå§‹å€¼å‘ç”Ÿæ”¹å˜åˆ™ä¸å…è®¸ setã€‚

CAS å‚è€ƒ [www.w3cschool.cn/architectroad/architectroad-solve-data-consistency-with-cas.html](https://www.w3cschool.cn/architectroad/architectroad-solve-data-consistency-with-cas.html)

## é€šç”¨å‘½ä»¤

* keys * ï¼šä¼šéå†å‡ºæ‰€æœ‰çš„keyï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨æ—¶é—´å¤æ‚åº¦O(n)
* dbsizeï¼šè®¡ç®—keyçš„æ€»æ•°ï¼ŒRediså†…ç½®äº†è¿™ä¸ªè®¡æ•°å™¨ï¼Œä¼šå®æ—¶æ›´æ–°keyçš„æ€»æ•°ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)
* existsï¼š```exists key``` æ£€æŸ¥keyæ˜¯å¦å­˜åœ¨ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)
* expireï¼š```expire key seconds```keyåœ¨secondsç§’åè¿‡æœŸï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)
* ttlï¼š```ttl key```keyå‰©ä½™çš„è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)
* persistï¼š```persist key```å»æ‰keyçš„è¿‡æœŸæ—¶é—´ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)
* typeï¼š```type key```æŸ¥çœ‹keyçš„ç±»å‹ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)

## äº”ç§æ•°æ®ç±»å‹

ä»¥ä¸‹ä»…åˆ—ä¸¾ä¸€äº›å¸¸ç”¨æ•°æ®ç±»å‹ï¼Œæ›´å¤šä¿¡æ¯å¯å‚è§å®˜ç½‘ 

#### å­—ç¬¦ä¸²

æœ€å¤§é™åˆ¶512MBï¼Œé€‚ç”¨äºç¼“å­˜ã€è®¡ç®—å™¨ã€åˆ†å¸ƒå¼é”ç­‰ã€‚

å‘½ä»¤ |   å«ä¹‰  | æ—¶é—´å¤æ‚åº¦
:-----:|:------:|:-------:
 setã€getã€del  | å¯¹keyè¿›è¡Œè®¾ç½®ã€è¯»å–ã€åˆ é™¤ | O(1)
 incrã€decr     | è®¡æ•° | O(1)
 incrbyã€decrby     | å¯¹è®¡æ•°è®¾ç½®å¢é‡ | O(1)
 setnx     | key å­˜åœ¨ï¼Œä¸åšä»»ä½•æ“ä½œ | O(1)
 getset     | è®¾ç½®æ–°å€¼è¿”å›æ—§å€¼ ``` getset key newValue```|  O(1)
 msetã€mget     | å¤šä¸ªkeyè¿›è¡Œè®¾ç½®ã€è¯»å–   | O(n) 

ä¾‹å¦‚ï¼Œå¯¹åŸå¸‚åˆ—è¡¨æ•°æ®è¿›è¡Œç¼“å­˜ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š

```js
function cityList() {
    const redisKey = 'city';
    let cities = redis.get(redisKey);

    if (!cities) {
        cities = mongo.getCityList();

        redis.set(redisKey, JSON.stringify(cities)); // å­˜å‚¨çš„æ—¶å€™è¿›è¡Œåºåˆ—åŒ–
    }

    return cities;
}
```

#### å“ˆå¸Œ

> æ‰€æœ‰å“ˆå¸Œçš„å‘½ä»¤éƒ½æ˜¯ä»¥Hå¼€å¤´

- **æ³¨æ„**ï¼šåœ¨ä½¿ç”¨hgetallçš„æ—¶å€™è¦æ³¨æ„ï¼Œå¦‚æœé›†åˆå¾ˆå¤§ï¼Œå°†ä¼šæµªè´¹æ€§èƒ½ã€‚
- **ä¼˜ç‚¹**ï¼šèŠ‚çœç©ºé—´ï¼Œå¯ä»¥éƒ¨åˆ†æ›´æ–°ã€‚
- **ç¼ºç‚¹**ï¼šä¸æ”¯æŒTTLè®¾ç½®ã€‚

å‘½ä»¤ |   å«ä¹‰  | æ—¶é—´å¤æ‚åº¦
:-----:|:------:|:-------:
 hset  | å¯¹keyè¿›è¡Œè®¾ç½®ï¼š```hset user:1 name zs age 20``` | O(1)
 hget  | è·å–æŒ‡å®šå±æ€§nameï¼š```hget user:1 name``` | O(1)
 hdel  | åˆ é™¤keyæŒ‡å®šå±æ€§nameï¼š```hdel user:1 name``` | O(1)
 hincrby  | ```hincrby user:1 count 1``` | O(1)
 hmsetã€hmget     | å¤šä¸ªkeyè¿›è¡Œè®¾ç½®ã€è¯»å–   | O(n) 
 hgetall  | è·å–keyçš„æ‰€æœ‰å±æ€§ï¼š```hgetall user:1``` | O(n)
 hvals  | è·å–keyçš„æ‰€æœ‰valueï¼š```hvals user:1``` | O(n)
 hkeys  | è·å–keyçš„æ‰€æœ‰fieldsï¼š```hkeys user:1``` | O(n)

#### åˆ—è¡¨

> åˆ—è¡¨çš„å‘½ä»¤éƒ½æ˜¯ä»¥Lå¼€å¤´

* `Stackï¼ˆæ ˆï¼‰`ï¼šåè¿›å…ˆå‡ºï¼Œå®ç°å‘½ä»¤`lpush + lpop`
* `Queueï¼ˆé˜Ÿåˆ—ï¼‰`ï¼šå…ˆè¿›å…ˆå‡ºï¼Œå®ç°å‘½ä»¤`lpush + rpop`
* `Capped Collectionï¼ˆæœ‰é™é›†åˆï¼‰`ï¼šlpush + ltrim
* `Message Queueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰`ï¼šlpush + brpop


å‘½ä»¤ |   å«ä¹‰  | æ—¶é—´å¤æ‚åº¦
:-----:|:------:|:-------:
 rpush  | åˆ—è¡¨å³ç«¯æ’å…¥ä¸€ä¸ªå€¼: ```rpush arr 1 2 3``` | O(1~n)
 lpush  | åˆ—è¡¨å·¦ç«¯æ’å…¥ä¸€ä¸ªå€¼: ```lpush arr 1 2 3``` | O(1~n)
 linsert  | åˆ—è¡¨æŒ‡å®šçš„å€¼å‰åæ’å…¥æ–°å€¼: ```linsert key before|after value newValue``` ```linsert arr before 2 b``` | O(n)
lpopã€rpop  | åˆ—è¡¨å·¦ä¾§æˆ–è€…å³ä¾§å¼¹å‡ºä¸€ä¸ªå€¼: ```lpop arr | rpop arr``` | O(1)
ltrim  | æŒ‰ç…§ç´¢å¼•èŒƒå›´ä¿®å‰ªåˆ—è¡¨: ```ltrim key start end``` | O(n)
lrange  | è·å–åˆ—è¡¨æŒ‡å®šç´¢å¼•èŒƒå›´æ‰€æœ‰item: ```lrange key start endï¼ˆåŒ…å«endï¼‰``` | O(n)
llen  | è·å–åˆ—è¡¨é•¿åº¦: ```llen key``` | O(1)
lset  | è®¾ç½®åˆ—è¡¨æŒ‡å®šç´¢å¼•å€¼ä¸ºnewValue: ```lset key index newValue``` | O(n)

#### é›†åˆ

> ä»¥Så¼€å¤´çš„å‘½ä»¤

* `sadd key element`ï¼šé›†åˆkeyä¸­æ·»åŠ å…ƒç´ elementï¼Œå¦‚æœelementå­˜åœ¨åˆ™æ·»åŠ å¤±è´¥ï¼ŒO(1)ã€‚
* `srem key element`ï¼šåˆ é™¤é›†åˆä¸­çš„å…ƒç´ ï¼ŒO(1)ã€‚
* `smembers key`ï¼šè·å–é›†åˆä¸­æ‰€æœ‰å…ƒç´ ï¼Œæ¬¡å‘½ä»¤è°¨æ…ä½¿ç”¨ï¼ŒO(n)ã€‚

#### æœ‰åºé›†åˆ

> ä»¥Zå¼€å¤´çš„å‘½ä»¤

æœ‰åºé›†åˆå…ƒç´ ç”±ä¸¤éƒ¨åˆ†ç»„æˆå…¶ä¸­scoreä»£è¡¨åˆ†æ•°ï¼ˆæ’åºï¼‰ï¼Œå…·ä½“å¯ä»¥çœ‹ä»¥å‘½ä»¤ä»‹ç»ï¼š

* zadd key score elementï¼šé›†åˆkeyä¸­æ·»åŠ å…ƒç´ elementï¼Œå¦‚æœelementå­˜åœ¨åˆ™æ·»åŠ å¤±è´¥ï¼ŒO(logN)ã€‚
* zrem key elementï¼šåˆ é™¤é›†åˆä¸­çš„å…ƒç´ ï¼ŒO(1)ã€‚
* zscore key elementï¼šè¿”å›å…ƒç´ çš„åˆ†æ•°ï¼ŒO(1)ã€‚
* zincrby key increScore elementï¼šå¢åŠ æˆ–å‡å°‘å…ƒç´ çš„åˆ†æ•°ï¼ŒO(1)ã€‚
* zcard key ï¼šè¿”å›å…ƒç´ çš„ä¸ªæ•°ï¼ŒO(1)ã€‚
* smembers keyï¼šè·å–é›†åˆä¸­æ‰€æœ‰å…ƒç´ ï¼Œæ¬¡å‘½ä»¤è°¨æ…ä½¿ç”¨ï¼ŒO(n)ã€‚

## Redisé«˜çº§ç‰¹æ€§

#### æ…¢æŸ¥è¯¢

> Redisæ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼šå‘é€å‘½ä»¤->æ’é˜Ÿ->æ‰§è¡Œå‘½ä»¤->è¿”å›ç»“æœï¼Œæ…¢æŸ¥è¯¢é€šå¸¸å‘ç”Ÿåœ¨æ‰§è¡Œå‘½ä»¤é˜¶æ®µï¼Œå¯ä»¥é€šè¿‡æ»¡æ—¥å¿—æŸ¥è¯¢ç³»ç»Ÿslowlogè¿›è¡Œé—®é¢˜å®šä½è·Ÿè¸ªã€‚

**åœ¨é…ç½®æ–‡ä»¶```redis.conf```ä¸­è®¾ç½®ï¼š**

* slowlog-max-lenï¼šè¡¨ç¤ºæ»¡æŸ¥è¯¢æœ€å¤§çš„æ¡æ•°ï¼Œé»˜è®¤128ï¼Œä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå½“è¶…è¿‡é¢„å…ˆè®¾ç½®çš„å€¼åä¼šå°†æœ€æ—©çš„slowlogåˆ é™¤ï¼Œæ˜¯ä¸ªå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ã€‚
* slowlog-log-slower-thanï¼šæ…¢æŸ¥è¯¢é˜€å€¼ï¼Œé»˜è®¤10000å¾®ç§’ï¼Œåªæœ‰å‘½ä»¤æ‰§è¡Œæ—¶é—´å¤§äºè¯¥é˜€å€¼æ‰ä¼šè¢«slowlogè®°å½•ï¼Œå¦‚æœè®°å½•æ‰€æœ‰å‘½ä»¤å°†é˜€å€¼è®¾ç½®ä¸º0ã€‚

**ä¸¤ç§è®¾ç½®æ–¹å¼ï¼š**
> Redisæ˜¯ä¸€ä¸ªæ¯ç§’ä¸‡çº§åˆ«çš„ï¼Œæ‰€ä»¥åœ¨è®¾ç½®é˜€å€¼çš„æ—¶å€™ï¼Œé»˜è®¤ä¸º10000å¾®å¦™ï¼ˆ10æ¯«ç§’ï¼‰ï¼Œä¸è¦è®¾ç½®å¤ªå¤§ï¼Œå»ºè®®1æ¯«ç§’ä¹‹ä¸‹ï¼Œè¿™æ ·æ‰æœ‰æ„ä¹‰ã€‚å®šæœŸå°†æ…¢æŸ¥è¯¢æŒä¹…åŒ–åˆ°å…¶ä»–æ•°æ®åº“ï¼Œä¾¿äºæ’æŸ¥ã€‚

* é…ç½®æ–‡ä»¶```redis.conf```ä¸­è®¾ç½®ï¼Œä»¥ä¸‹ä¸ºé»˜è®¤è®¾ç½®ï¼š
    * `slowlog-log-slower-than 10000`
    * `slowlog-max-len 128`
* configåŠ¨æ€è®¾ç½®slowlogï¼š
    * `slowlog-max-len 1000`
    * `slowlog-log-slower-than 1000`

**æ…¢æŸ¥è¯¢å‘½ä»¤ï¼š**
* `slowlog get [n]`ï¼šè·å–æ…¢æŸ¥è¯¢é˜Ÿåˆ—
* `slowlog len`ï¼šè·å–æ…¢æŸ¥è¯¢é˜Ÿåˆ—é•¿åº¦
* `slowlog reset`ï¼šæ¸…ç©ºæ…¢æŸ¥è¯¢é˜Ÿåˆ—

#### pipeline

æ ¸å¿ƒï¼š1æ¬¡ç½‘ç»œè¯·æ±‚å¤„ç†næ¡å‘½ä»¤ï¼ŒRedisæœ¬èº«å‘½ä»¤å¤„ç†æ—¶é—´æ˜¯å¾®å¦™çº§åˆ«ï¼Œpipelineä¸»è¦è§£å†³å°±æ˜¯å‡å°‘ç½‘ç»œä¼ è¾“çš„è¯·æ±‚ã€‚

#### å‘å¸ƒè®¢é˜…

è§’è‰²ï¼šå‘å¸ƒè€…ï¼ˆpublisherï¼‰ã€è®¢é˜…è€…ï¼ˆsubscriberï¼‰ã€é¢‘é“ï¼ˆchannelï¼‰
APIï¼š
* å‘å¸ƒæ¶ˆæ¯```publish channel message```
* è®¢é˜…æ¶ˆæ¯```subscribe [channe] # å¯ä»¥è®¢é˜…å¤šä¸ªé¢‘é“```
* å–æ¶ˆè®¢é˜…```unsubscribe [channel]```

#### BitMapsï¼ˆä½å›¾ï¼‰
#### HyperLogLogï¼ˆè¶…å°å†…å­˜å”¯ä¸€è®¡æ•°
#### GEO
Redis3.2+æ”¯æŒï¼Œç”¨äºåœ°ç†ä¿¡æ¯å®šä½ï¼ŒåŸºäºzsetå®ç°ã€‚

APIï¼š
* ```geoadd key longitude latitude member```å¢åŠ åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œç¤ºä¾‹ï¼š```geoadd cities: 116.31 39.99 beijing```

* ```geopos key member [member...]```è·å–åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œç¤ºä¾‹ï¼š```geopos cities: beijing```

* ```geodist key member1 member2 [unit]```è·å–ä¸¤åœ°ç†ä½ç½®è·ç¦»ï¼Œunitä¸ºå•ä½(mï¼Œç±³ï¼›kmï¼Œåƒç±³ï¼›miï¼Œè‹±é‡Œï¼›ftï¼Œå°º)ï¼Œç¤ºä¾‹ï¼š```geodist cities: beijing shanghai km```

## é˜…è¯»æ¨è

* [Redis è®¾è®¡ä¸å®ç°](http://redisbook.com/index.html)
* [Redis å¼€å‘ä¸è¿ç»´](https://book.douban.com/subject/26971561/)
* [Redis CacheCloud](https://github.com/sohutv/cachecloud)
* [æå®¢å­¦é™¢ Redis WIKI](http://wiki.jikexueyuan.com/list/redis/)
